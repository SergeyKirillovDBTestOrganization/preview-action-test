name: 'Create Preview Environment'
description: 'Deploy a Full-Stack Preview Environment (on-demand, ephemeral) with Uffizzi Open Source (Compose + Uffizzi + Kubernetes)'
author: 'Adam Vollrath'
branding:
  color: 'yellow'
  icon: 'upload-cloud'
inputs:
  compose-file:
    description: 'An alternate compose file'
    required: false
    default: 'docker-compose.yaml'
  server:
    description: 'URL to Uffizzi'
    required: false
    default: 'https://app.uffizzi.com'
  username:
    description: 'Uffizzi username'
    required: false
  password:
    description: 'Uffizzi password'
    required: false
  project:
    description: 'Uffizzi project name'
    required: false
  auth_personal_access_token:
    description: 'Github Personal Access Token with user:email scope if you do not have account on Uffizzi'
outputs:
  url:
    description: 'URL where preview was deployed, if successful'
  id:
    description: 'ID of prevew for later reference'
runs:
  using: 'docker'
  image: 'docker://sergeykirillov/zi_cli:latest'
  args:
    - 'preview'
    - 'create'
    - '--output=github-action'
    - ${{ inputs.compose-file }}
  env:
    UFFIZZI_PASSWORD: ${{ inputs.password }}
    UFFIZZI_SERVER: ${{ inputs.server }}
    UFFIZZI_USER: ${{ inputs.username }}
    UFFIZZI_PROJECT: ${{ inputs.project }}
    GITHUB_PERSONAL_ACCESS_TOKEN: ${{ inputs.auth_personal_access_token }}
